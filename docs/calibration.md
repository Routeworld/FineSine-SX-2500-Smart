

Вот **полная обновлённая принципиальная схема** с **всеми резисторами делителя** (как в твоём оригинальном коде multiply: 9.2):

```markdown
# Полная принципиальная схема FineSine SX-2500 Smart (с делителем АКБ)

```
                          220В СЕТЬ
                               │
                               │
                    ┌──────────┴──────────┐
                    │   Контактор         │
                    │ CHNT NC1-4011 40А   │
                    └──────────┬──────────┘
                               │
                               ▼
                  ВХОД ИБП ExeGate FineSine SX-2500
                               │
                 ┌─────────────┴─────────────┐
                 │                           │
          +24В ───┴─── БАТАРЕЯ ──── GND      ВЫХОД 220В
                 │                           │
                 │                           │
                 ▼                           ▼
           [SCT-013-030]               [SCT-013-030]
           (Ток вход)                  (Ток выход)

Делитель напряжения АКБ (для GPIO34)
──────────────────────────────────────
+24В (от батареи) ───────┬─────────────────────── +24В (на XL4015)
                         │
                       R1 = 82 kΩ (1% или 0.1%)
                         │
   ТОЧКА ИЗМЕРЕНИЯ ──────┼──────► GPIO34 (ADC)
                         │
                       R2 = 10 kΩ (1%)
                         │
                        GND

Защита ADC:
ТОЧКА ИЗМЕРЕНИЯ ── 1 kΩ ──► GPIO34
                       │
                     3.3V стабилитрон (или TVS-диод P6KE6.8A)
                       │
                     100 nF керамический конденсатор на GND


ESP32 DevKit
──────────────────────────────────────────────────────
GPIO25 ─────────────────────► Управление контактором (через оптореле 5В)
GPIO27 ─────────────────────► Контрольная лампа LED (+ резистор 330 Ω)
GPIO34 ─────────────────────► Делитель напряжения АКБ (см. выше)
GPIO35 ─────────────────────► ZMPT101B (напряжение сети)
GPIO32 ─────────────────────► SCT-013-030 (ток от сети)
GPIO33 ─────────────────────► SCT-013-030 (ток на нагрузку)

Питание:
24В батарея ──► XL4015 (DC-DC) ──► 5В → VIN ESP32
               (настройка 5.0 В, конденсаторы 470–1000 мкФ на вход/выход)
```

### Почему именно 82 кΩ + 10 кΩ = коэффициент 9.2

- Максимальное напряжение АКБ ≈ 29 В  
- 29 В / 9.2 ≈ 3.15 В → идеально влезает в 3.3 В ADC ESP32 с запасом  
- Точность: бери резисторы 1% (или хотя бы 5%) — в коде уже стоит `multiply: 9.2` + `calibrate_linear`

### Рекомендую добавить (для надёжности):
- Последовательный резистор 1 кΩ перед GPIO34 (защита от бросков)
- Стабилитрон 3.3 В (или лучше bidirectional TVS)
- Керамический конденсатор 100 нФ прямо у GPIO34 на GND

