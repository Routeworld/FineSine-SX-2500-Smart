███ 220В СЕТЬ (фаза) ─── Коричневый провод ───┬───[Контакт 1 контактора]───┬─── ВХОД ИБП (фаза)
███ 220В СЕТЬ (ноль) ─── Синий провод ────────┴───[Контакт 2 контактора]───┴─── ВХОД ИБП (ноль)
                                                    │
                                                    │ Катушка контактора (A1)
                                                    ▼
                                              ╔═══════════╗
                                              ║  РЕЛЕ 5В  ║ (модуль с опторазвязкой)
                                              ║ SRD-05VDC ║
                                              ╚═══════════╝
                                                    ▲
                                                    │ Катушка реле (IN1)
                                                    │
                                              ╔═════▼═════╗
                                              ║   ESP32   ║
                                              ║ GPIO 25   ║─────── Коричневый провод
                                              ║ GND       ║─────── Чёрный провод
                                              ╚═══════════╝

══════════════════════════════════════════════════════════════════════════

🔋 БАТАРЕЯ 24В (LiFePO4) ─── Красный (+) ────┬───[XL4015 IN+]───┬───[XL4015 OUT+ 5В]─── VIN ESP32
                                              │                   │
                                              ├───[XL4015 IN-]───┴───[XL4015 OUT-]────── GND ESP32
                                              │
                                              └───┬───[Резистор 100 кОм]───┬─── GPIO34 (ADC)
                                                  │                        │
                                                  └───[Резистор 10 кОм]────┴─── GND

══════════════════════════════════════════════════════════════════════════

⚡ ДАТЧИК НАПРЯЖЕНИЯ СЕТИ (ZMPT101B)
220В фаза ────┬───[Клеммник ZMPT вход ~]───┐
              │                            │
220В ноль ────┴───[Клеммник ZMPT вход ~]───┘
                                              ZMPT101B
                                    ┌───────────┴───────────┐
                                    VCC 5В ──────────────┐   │
                                    GND ─────────────────┼───┤
                                    OUT (сигнал) ────────┘   │
                                                              ▼
                                                         GPIO35 (ADC)
                                                              │
                                                              └─[Конденсатор 10 мкФ]──GND

══════════════════════════════════════════════════════════════════════════

🔌 ДАТЧИКИ ТОКА (SCT-013-030) x 2
┌──────────────────────────────────────────────────────────────────────┐
│ SCT-013 (ВХОДНОЙ ТОК — на фазе от контактора к ИБП)                  │
│      ╭─────╮                                                         │
│      │ SCT │────── Белый ──► GPIO32 (ADC)                            │
│      ╰─────╯────── Чёрный ──► GND                                    │
│         │                                                            │
│         └──────[Встроенный резистор 62 Ом]───┐                       │
│                                              │                       │
│ SCT-013 (ВЫХОДНОЙ ТОК — на фазе от ИБП к нагрузке)                  │
│      ╭─────╮                                                         │
│      │ SCT │────── Белый ──► GPIO33 (ADC)                            │
│      ╰─────╯────── Чёрный ──► GND                                    │
│         │                                                            │
│         └──────[Встроенный резистор 62 Ом]───┐                       │
│                                              │                       │
└──────────────────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════════════════════

💡 КОНТРОЛЬНАЯ ЛАМПА
GPIO27 ──┬──[Резистор 330 Ом]──┬── Анод(+) светодиода
         │                     │
         └─────────────────────┴── Катод(-) светодиода ── GND

══════════════════════════════════════════════════════════════════════════

⚠️ ЗАЩИТНЫЙ ДИОД ДЛЯ КОНТАКТОРА
                    ┌──[Диод 1N4007]──┐
                    │                  │
Катушка A1 ────────┴──                ├──────── Катушка A2
                    (катод к +)        │
                                       └────────────


📋 ТАБЛИЦА ПОДКЛЮЧЕНИЙ (ШПАРГАЛКА)
Что	Куда на ESP	Цвет провода	Номинал / Примечание
Питание ESP	VIN	Красный	С выхода XL4015 (5В)
GND	GND	Чёрный	Общий минус
Управление контактором	GPIO25	Коричневый	Через реле-модуль 5В (SRD-05VDC)
Контрольная лампа	GPIO27	Жёлтый	+ резистор 330 Ом
Напряжение АКБ	GPIO34	Оранжевый	Делитель 100к + 10к
Напряжение сети (ZMPT)	GPIO35	Синий	Выход ZMPT101B + конденсатор 10 мкФ
Ток вход (сеть)	GPIO32	Белый	SCT-013-030 (30А)
Ток выход (нагрузка)	GPIO33	Зелёный	SCT-013-030 (30А)
+5В для ZMPT	5V	Красный	Питание датчика напряжения
GND для всех датчиков	GND	Чёрный	Общий провод
⚙️ НАСТРОЙКА XL4015 (DC-DC понижайка)
Подключи вход XL4015 к батарее 24В (красный +, чёрный -).

Подключи выход XL4015 к ESP32 (VIN и GND).

Настрой напряжение:

Подключи мультиметр к выходу

Крути подстроечный резистор, пока не увидишь 5.0В ±0.1В

Обязательно поставь конденсаторы:

На вход: 1000 мкФ 35В (между + и -)

На выход: 1000 мкФ 10В (между + и -)

✅ ПРОВЕРКА ПЕРЕД ВКЛЮЧЕНИЕМ
Контактор подключен через реле-модуль, а не напрямую к ESP

Делитель 100к + 10к собран и подключен к GPIO34

Все GND соединены в одну точку

Напряжение на GPIO34 измерено мультиметром — не больше 3.3В

XL4015 настроен на 5.0В до подключения ESP

SCT-013 висят на фазовых проводах (не на нуле)
