
---

```markdown
# Полная детальная принципиальная схема  
FineSine SX-2500 Smart UPS (версия 22.02.2026)

```
                              220В СЕТЬ (L + N)
                                     │
                                     │
                          ┌──────────┴──────────┐
                          │ Контактор CHNT      │
                          │ NC1-4011 40А (NO)   │
                          │ Катушка: 230В AC    │
                          └──────────┬──────────┘
                                     │
                                     ▼
                       ВХОД ИБП ExeGate FineSine SX-2500
                                     │
                 ┌───────────────────┴───────────────────┐
                 │                                       │
          +24В ───┴─── LiFePO4 / AGM ──── GND            ВЫХОД 220В (L + N)
                 │                                       │
                 │                                       │
                 ▼                                       ▼
          SCT-013-030 (ток вход)                 SCT-013-030 (ток выход)
                 │                                       │
                 └──────────────────┬────────────────────┘
                                    │
                                    ▼
                               НАГРУЗКА 220В


ДЕЛИТЕЛЬ НАПРЯЖЕНИЯ АКБ (GPIO34) — коэффициент 9.2
──────────────────────────────────────────────────────
+24В (от батареи) ──────── R1 = 82 kΩ 1% ───────┬─────── +24В (на XL4015)
                                                │
                                      ТОЧКА ────┼──────► GPIO34 (ADC)
                                                │
                                              R2 = 10 kΩ 1%
                                                │
                                               GND

Защита ADC (обязательно!):
ТОЧКА ── 1 kΩ (защитный) ──► GPIO34
                       │
                     3.3В стабилитрон (BZX55C3V3 или лучше TVS P6KE6.8CA)
                       │
                     100 nF керамика (параллельно GND прямо у пина)


ПИТАНИЕ ESP32
──────────────────────────────────────────────────────
+24В батарея ──► XL4015 (DC-DC понижитель)
                  IN+ ── +24В
                  IN- ── GND
                  OUT+ ── 5.00В (точно настроить!)
                  OUT- ── GND
                  Настройка: крутим подстроечник до 5.05В под нагрузкой

5В ──► VIN ESP32 (или 5V пин)
GND ──► GND ESP32
Добавить конденсаторы:
- 1000 мкФ 35В на вход XL4015
- 470 мкФ 10В + 100 нФ на выход XL4015


ESP32 DevKit — подключение
──────────────────────────────────────────────────────
GPIO25 (выход) ── 1 kΩ ── Опторазвязка / Реле-модуль 5В ── Катушка контактора
GPIO27 (выход) ── 330 Ω ── LED (контрольная лампа) ── GND

GPIO34 (ADC) ── делитель АКБ + защита (см. выше)
GPIO35 (ADC) ── ZMPT101B (выход модуля)
GPIO32 (ADC) ── SCT-013-030 (ток вход) — выход модуля
GPIO33 (ADC) ── SCT-013-030 (ток выход) — выход модуля

3.3V ESP32 ── питание ZMPT101B и SCT-013 (если нужно)
GND ── общий для всего


Цвета проводов (рекомендация для монтажа в корпусе)
──────────────────────────────────────────────────────
+24В батарея          — Красный толстый (2.5–4 мм²)
GND батарея           — Чёрный толстый
220В L (сеть)         — Коричневый
220В N (сеть)         — Синий
220В на нагрузку L    — Коричневый
220В на нагрузку N    — Синий
Сигнал контактора     — Жёлтый
Сигнал лампы          — Белый
ADC напряжение АКБ    — Оранжевый
ADC ток/напряжение    — Зелёный
Питание 5В ESP        — Красный тонкий
GND ESP               — Чёрный тонкий
```

### Таблица пинов ESP32

| Пин ESP32 | Назначение                     | Компонент                     | Примечание                     |
|-----------|--------------------------------|-------------------------------|--------------------------------|
| GPIO25    | Управление контактором         | Оптореле / реле-модуль        | Обязательно гальваническая развязка |
| GPIO27    | Контрольная лампа              | LED + 330 Ω                   | Мигает при <20% и без сети     |
| GPIO34    | Напряжение АКБ                 | Делитель 82k + 10k            | multiply: 9.2 в коде           |
| GPIO35    | Напряжение сети                | ZMPT101B                      | —                              |
| GPIO32    | Ток от сети                    | SCT-013-030                   | —                              |
| GPIO33    | Ток на нагрузку                | SCT-013-030                   | —                              |
| VIN / 5V  | Питание                        | XL4015 (5.00 В)               | —                              |



